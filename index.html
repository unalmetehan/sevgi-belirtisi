<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sonsuz Aşk - Rastgele Akış</title>
<link href="https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap" rel="stylesheet">
<style>
    html, body {
        margin: 0;
        padding: 0;
        overflow: hidden;
        background: #020205;
    }
    canvas { display:block; }
</style>
</head>
<body>

<canvas id="c"></canvas>

<script>
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d", { alpha: false });

let w, h, DPR;
function resize(){
    DPR = Math.max(1, Math.min(2, devicePixelRatio||1));
    w = canvas.width = innerWidth * DPR;
    h = canvas.height = innerHeight * DPR;
    canvas.style.width = innerWidth + "px";
    canvas.style.height = innerHeight + "px";
}
window.addEventListener("resize", resize);
resize();

const rand = (a,b)=>Math.random()*(b-a)+a;
const TAU = Math.PI*2;
let time = 0;

/* ======= YARDIMCI MATEMATİK ======= */
function heartXY01(t){
    const a = t*TAU;
    const x = 16*Math.pow(Math.sin(a),3);
    const y = 13*Math.cos(a)-5*Math.cos(2*a)-2*Math.cos(3*a)-Math.cos(4*a);
    return {x, y:-y};
}

const n1 = x => Math.sin(x*1.13)+Math.sin(x*0.47)*0.5+Math.sin(x*2.07)*0.25;
function curlNoise(x,y,t){
    const e=0.0022, s=0.004, sp=0.15;
    const a  = n1(x*s + t*sp) + n1(y*s + t*sp);
    const ax = n1((x+e)*s + t*sp) + n1(y*s + t*sp);
    const ay = n1(x*s + t*sp) + n1((y+e)*s + t*sp);
    return { vx: -(ay-a)/e, vy: (ax-a)/e };
}

function strokeSeg(x1,y1,x2,y2,hue,alpha,width,taper){
    const widthScaled = width * (0.35+0.65*taper);
    ctx.globalCompositeOperation="screen"; 
    ctx.lineCap="round";

    ctx.lineWidth = widthScaled*5.0;
    ctx.strokeStyle = `hsla(${hue},95%,60%,${alpha*0.15})`;
    ctx.beginPath(); ctx.moveTo(x1,y1); ctx.lineTo(x2,y2); ctx.stroke();

    ctx.lineWidth = widthScaled*1.0;
    ctx.strokeStyle = `hsla(${hue},98%,85%,${alpha*0.4})`;
    ctx.beginPath(); ctx.moveTo(x1,y1); ctx.lineTo(x2,y2); ctx.stroke();
}

/* ======= SINIFLAR ======= */
class Star {
    constructor(){ this.reset(); }
    reset(){
        this.x = rand(0,w); this.y = rand(0,h);
        this.r = rand(0.5, 2.5) * DPR;
        this.a = rand(0.1, 0.6);
        this.v = rand(0.2, 0.5) * DPR;
    }
    draw(){
        this.y -= this.v;
        if(this.y < 0) this.reset();
        ctx.globalCompositeOperation = "source-over";
        ctx.fillStyle = `rgba(255,255,255,${this.a})`;
        ctx.beginPath(); ctx.arc(this.x, this.y, this.r, 0, TAU); ctx.fill();
    }
}
const stars = Array.from({length:80}, ()=>new Star());

class YarnHeart {
    constructor(){
        // Konum: Ekranın her yerine dağılsın
        this.cx = w/2 + rand(-w*0.45, w*0.45);
        this.cy = h/2 + rand(-h*0.35, h*0.35);
        this.scale = rand(5, 9) * DPR; 
        
        // ÖMÜR AYARLARI
        this.life = 0; // 0'dan başlayıp parlayacak (Fade In)
        this.maxLife = 1.0;
        this.state = "born"; // born -> alive -> dying
        this.fadeInSpeed = rand(0.01, 0.03);
        this.decay = rand(0.0005, 0.0015);

        this.threads = [];
        const count = 150; // Biraz optimize ettik ki sayı artınca kasmasın
        for(let i=0; i<count; i++){
            const isVein = Math.random() < 0.25;
            const u = rand(0,1);
            const inward = rand(0.1, 0.9);
            const p = heartXY01(u);
            this.threads.push({
                isVein, u,
                x: this.cx + p.x * this.scale * inward,
                y: this.cy + p.y * this.scale * inward,
                vx:0, vy:0,
                hue: isVein ? rand(300, 340) : rand(335, 360),
                speed: isVein ? rand(0.003, 0.006) : rand(0.001, 0.003),
                spiral: isVein ? rand(2,8)*DPR : rand(5,15)*DPR,
                jitter: isVein ? rand(2,4) : rand(1,2),
                w: rand(0.5, 1.5) * DPR
            });
        }
    }

    updateAndDraw(dt, t){
        // ÖMÜR MANTIĞI (Fade In / Fade Out)
        if(this.state === "born"){
            this.life += this.fadeInSpeed;
            if(this.life >= 1.0){
                this.life = 1.0;
                this.state = "dying";
            }
        } else {
            this.life -= this.decay;
        }

        this.cy -= 0.1 * DPR; // Çok yavaş yukarı

        for(let a of this.threads){
            a.u += a.speed;
            if(a.u > 1) a.u -= 1;
            const p = heartXY01(a.u);
            const inward = a.isVein ? 0.55 : 0.72;
            const baseS = this.scale * inward;
            const ang = (a.u * TAU * (a.isVein?6:3)) + t*(a.isVein?3.0:1.6);
            const sx = Math.cos(ang) * a.spiral;
            const sy = Math.sin(ang) * a.spiral;
            const tx = this.cx + p.x*baseS + sx;
            const ty = this.cy + p.y*baseS + sy;
            const cn = curlNoise(a.x, a.y, t);

            a.vx += (tx - a.x) * 0.06 + cn.vx * a.jitter;
            a.vy += (ty - a.y) * 0.06 + cn.vy * a.jitter;
            a.vx *= 0.90; a.vy *= 0.90;

            const ox = a.x; const oy = a.y;
            a.x += a.vx; a.y += a.vy;

            const alpha = this.life * (a.isVein ? 0.9 : 0.5); 
            if(alpha > 0.01){
                strokeSeg(ox, oy, a.x, a.y, a.hue, alpha, a.w, 0.8);
            }
        }
    }
}

let hearts = [];
const MAX_HEARTS = 15; // HEDEF SAYI ARTTI

class Stem{
    constructor(x,y,a,d){
        this.x=x; this.y=y; this.a=a; this.d=d;
        this.len=0; this.max=rand(60,110) * DPR; this.speed=rand(0.6,1.2) * DPR;
        this.children=[]; this.bloom=false;
    }
    update(){
        if(this.len < this.max){
            this.len += this.speed; this.a += Math.sin(time*0.01)*0.002;
        } else {
            if(this.d > 0 && this.children.length===0){
                if(Math.random() > 0.96){
                    this.children.push(new Stem(this.endX,this.endY,this.a-0.4,this.d-1));
                    this.children.push(new Stem(this.endX,this.endY,this.a+0.4,this.d-1));
                }
            } else this.bloom=true;
        }
        this.endX = this.x + Math.cos(this.a)*this.len;
        this.endY = this.y + Math.sin(this.a)*this.len;
        this.children.forEach(c=>c.update());
    }
    draw(){
        ctx.globalCompositeOperation="screen";
        ctx.strokeStyle=`hsla(100, 70%, 50%, ${this.d/6})`;
        ctx.lineWidth = this.d * DPR * 0.5; ctx.lineCap = "round";
        ctx.beginPath(); ctx.moveTo(this.x,this.y); ctx.lineTo(this.endX,this.endY); ctx.stroke();
        if(this.bloom){
            ctx.fillStyle="rgba(255,80,140,0.8)";
            ctx.shadowBlur=15; ctx.shadowColor="pink";
            ctx.beginPath(); ctx.arc(this.endX,this.endY, 3*DPR, 0, TAU); ctx.fill();
            ctx.shadowBlur=0;
        }
        this.children.forEach(c=>c.draw());
    }
}
const flower = new Stem(w/2, h, -Math.PI/2, 6);

let textAlpha=0;
function drawText(){
    textAlpha = Math.min(textAlpha+0.003, 1);
    ctx.globalCompositeOperation = "source-over";
    ctx.textAlign="center";
    ctx.shadowColor="gold"; ctx.shadowBlur=20;
    ctx.fillStyle=`rgba(255, 210, 125, ${textAlpha})`;
    let fs1 = Math.min(w,h) * 0.05;
    ctx.font=`${fs1}px 'Great Vibes'`;
    ctx.fillText("İyi ki Doğdun Sevgilim", w/2, h*0.15);
    let fs2 = fs1 * 0.7;
    ctx.font=`${fs2}px 'Great Vibes'`;
    ctx.fillText("Kasım’lı değil,", w/2, h*0.25);
    ctx.fillText("Aralıksız seviyorum seni.", w/2, h*0.32);
    ctx.shadowBlur=0;
}

let last = performance.now();
function animate(now){
    const dt = Math.min(0.033, (now-last)/1000);
    last = now;
    time += dt;

    ctx.globalCompositeOperation = "source-over";
    ctx.fillStyle = "rgba(2, 3, 10, 0.15)";
    ctx.fillRect(0,0,w,h);

    stars.forEach(s => s.draw());

    // --- GÜNCELLENMİŞ SPAWN MANTIĞI ---
    // Hepsini aynı anda doğurmak yerine rastgele zamanlarda ekle
    // Eğer ekrandaki kalp sayısı hedeften azsa, %3 şansla yeni bir tane ekle
    if(hearts.length < MAX_HEARTS && Math.random() < 0.03){
        hearts.push(new YarnHeart());
    }

    for(let i=hearts.length-1; i>=0; i--){
        hearts[i].updateAndDraw(dt, time);
        if(hearts[i].life <= 0 && hearts[i].state === "dying") {
            hearts.splice(i, 1);
        }
    }

    flower.update();
    flower.draw();
    drawText();

    requestAnimationFrame(animate);
}

resize();
flower.x = w/2; flower.y = h;
animate(performance.now());

</script>
</body>
</html>
